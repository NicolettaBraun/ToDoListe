<html>
    <head>
		<link rel="stylesheet" href="stylesheet.css">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		
		<script type="text/javascript">
		function initXmlRequests() {
			var xmlHttpReq = false;
			var self = this;
			// Mozilla/Safari
			if (window.XMLHttpRequest) {
				self.xmlHttpReq = new XMLHttpRequest();
			}
			// IE
			else if (window.ActiveXObject) {
				self.xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
			}
			self.xmlHttpReq.open('POST', 'http://localhost:8081/cgi-bin/todohandler', true);
			self.xmlHttpReq.setRequestHeader('Content-Type',
			'application/x-www-form-urlencoded');
			self.xmlHttpReq.onreadystatechange = function() {
				if (self.xmlHttpReq.readyState == 4) {
					updatepage(self.xmlHttpReq.responseText);
				}
			}
		}
		function addToTodolist() {
			initXmlRequests();
			
			var description = document.getElementById("content").value;
			
			var u = document.getElementById("user");
			var user = u.options[u.selectedIndex].value;
			
			var p = document.getElementById("priorität");
			var prio = p.options[p.selectedIndex].value;
			
			qstr = 'content=' + description;
			qstr = qstr + "&action=add";
			qstr = qstr + '&user=' + user;
			qstr = qstr + '&prio=' + prio + "\n"
			
			self.xmlHttpReq.send(qstr);
			setTimeout(showTodoList(), 250);
		}
		function showTodoList() {
			initXmlRequests();
			self.xmlHttpReq.send("action=show\n");
		}
		function clearList() {
			initXmlRequests();
			self.xmlHttpReq.send("action=delete\n");
		}
		function deleteItem(){
			initXmlRequests();
			qstr = 'pos=' + padLeft(globVarElement,5);
			qstr = qstr + "&action=deleteitem\n"
			self.xmlHttpReq.send(qstr);
		}
		function updatepage(str){
			document.getElementById("result").innerHTML = str;  
		}
		function padLeft(nr, n, str){
			return Array(n-String(nr).length+1).join(str||'0')+nr;
		}
		function sortUser(){
			initXmlRequests();
			self.xmlHttpReq.send("action=sortuser\n");
		}
		function nothing(){
			console.log("nicht intigriert");
		}
		
		globVarElement = "00000";
		function showMenu(str){
			globVarElement = str;
			var x = document.getElementById('hiddenMenu');
			if (x.style.visibility === 'hidden') {
				x.style.visibility = 'visible';
			} else {
				x.style.visibility = 'hidden';
			}
		}
		window.onclick = function(event) {
			if (!event.target.matches('.testClass')&&!event.target.matches('.input')) {	
				console.log("1");
				var x = document.getElementById("hiddenMenu");
				if (x.style.visibility === 'visible') {
					x.style.visibility = 'hidden';
				}
			}
		}
		
		
		window.onload = showTodoList;
		</script>
		
		<title>ToDo Liste in COBOL</title>
	</head>
	
	<body>
		Eine ToDo Liste in COBOL<br><p>
		
		<form id="input" class="input">
			<div>
				<p>ToDo:  <input value="ToDo" type="text" id="content" class="content"> </p>
				<p>User:  <select id="user" class="user">
							<option value="Tick" selected>Tick</option>
							<option value="Trick">Trick</option>
							<option value="Track">Track</option>
							<option value="others">others</option>
						</select> </p>
				<p>DueDate:  <input value="nicht intigriert" type="text" id="dueDate" class="dueDate"> </p>
				<p>Priorität:  <select id="priorität" class="priorität">
						  <option value="5">Hoch</option>
						  <option value="4">Mittel</option>
						  <option value="3">Niedrig</option>
						  <option value="2" selected>-------</option>
						</select></p>
			</div>
		</form>
		
		<p>
		<input value="Hinzufügen" type="button" onclick='javascript:addToTodolist()'>
		<input value="Liste löschen" type="button" onclick='javascript:clearList()'>
		<input value="Sortieren " type="button" onclick='javascript:sortUser()'>
		</p>
		
		<div id="hiddenMenu" class="result">
			<input class="ddm" value="Löschen" type="button" onclick='javascript:deleteItem()'>
			<input class="ddm" value="Due Date" type="button" onclick='javascript:nothing()'>
			<input class="ddm" value="Priorität" type="button" onclick='javascript:nothing()'>
			<input class="ddm" value="Status" type="button" onclick='javascript:nothing()'>
		</div>
				
		<div id="result" class="result"></div>
	</body>
</html>
